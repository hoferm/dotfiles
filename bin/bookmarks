#!/usr/bin/sh
BROWSER=${BROWSER:-firefox}
DELETE=false
FILE="$HOME/.bookmarks"

delete_bookmark() {
    rg -v -x -F "$1" "$FILE" > "bookmark.tmp"; mv "bookmark.tmp" "$FILE"
}

open_bookmark() {
    [ -n "$1" ] && $BROWSER "$1"
}

add_bookmark() {
    echo "$1" >> "$FILE"
}

while getopts ":da:" opt; do
    case $opt in
        a)
            url=${OPTARG}
            add_bookmark "$url"
            exit 0
            ;;
        d)
            DELETE=true
            ;;
        *)
            exit 1
            ;;
    esac
done
shift $((OPTIND-1))

if [ $DELETE = true ]; then
    if [ -z "$1" ]; then
        delete_bookmark "$(bat "$FILE" | rofi -dmenu -i -p "Delete bookmark")"
    else
        delete_bookmark "$1"
    fi
else
    open_bookmark "$(bat "$FILE" | rofi -dmenu -i -p "Open bookmark")"
fi
